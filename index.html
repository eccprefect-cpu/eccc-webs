
<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefects' Guild - Eheliyagoda Central College</title>
    <link rel="icon" href="meroon Transparent logo prefect.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* All CSS styles from your previous file are included here... */
        :root {
            --primary-color: #8C1C13;
            --secondary-color: #C6A98F;
            --text-color: #3b3b3b;
            --text-light: #5f5f5f;
            --card-bg-color: #FFFAF0;
            --light-text-color: #ffffff;
            --glass-bg: rgba(255, 250, 240, 0.75);
            --success-color: #28a745;
        }

        body.dark-mode {
            --text-color: #e8e8e8;
            --text-light: #b0b0b0;
            --card-bg-color: #121212;
            --glass-bg: rgba(30, 30, 30, 0.75);

            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            background-attachment: fixed;
        }

        /* Specific overrides for dark mode */
        body.dark-mode .portfolio-header.header-scrolled { background-color: rgba(26, 26, 26, 0.85); border-color: rgba(255,255,255,0.1); }
        body.dark-mode .portfolio-header.header-scrolled h1,
        body.dark-mode .portfolio-header.header-scrolled .desktop-nav-links a { color: var(--text-color); }
        body.dark-mode .portfolio-header.header-scrolled .desktop-nav-links a:hover { color: var(--secondary-color); border-color: var(--secondary-color); }
        body.dark-mode .portfolio-header.header-scrolled #menu-toggle span { background: var(--text-color); }
        body.dark-mode .portfolio-section { border-color: rgba(255, 255, 255, 0.1); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); }
        body.dark-mode .prefect-card,
        body.dark-mode .gallery-item,
        body.dark-mode .testimonial-card,
        body.dark-mode .announcement-card { background: #1e1e1e; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        body.dark-mode .prefect-card:hover,
        body.dark-mode .testimonial-card:hover,
        body.dark-mode .announcement-card:hover { box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        body.dark-mode .prefects-controls input { background-color: #2a2a2a; border-color: #444; color: var(--text-color); }
        body.dark-mode #category-filter-list li button { background-color: rgba(255,255,255,0.05); color: var(--text-light); }
        body.dark-mode #category-filter-list li button:hover { background-color: var(--secondary-color); color: #121212; }
        body.dark-mode #category-filter-list li button.active { background-color: var(--primary-color); color: white; }
        body.dark-mode .portfolio-footer { background: #121212; border-top-color: #333; }
        body.dark-mode .social-icons a { background-color: rgba(140, 28, 19, 0.2); }
        body.dark-mode .social-icons a:hover { background-color: var(--primary-color); }
        body.dark-mode .copyright-main { color: var(--text-color); }
        body.dark-mode .auth-card { background: rgba(30, 30, 30, 0.75); }
        body.dark-mode .creators-card { background: rgba(26, 26, 26, 0.85); border-left-color: rgba(255, 255, 255, 0.1); }
        body.dark-mode .developer-accordion-item { background: rgba(255, 255, 255, 0.05); border-color: rgba(255, 255, 255, 0.1); }
        body.dark-mode .developer-accordion-item:hover { background: rgba(255, 255, 255, 0.1); }
        body.dark-mode .developer-accordion-header h4, body.dark-mode .developer-accordion-header .role { color: var(--text-light); }
        body.dark-mode .main-nav { background-color: rgba(26, 26, 26, 0.7); }
        body.dark-mode .main-nav a { color: var(--text-color); }
        body.dark-mode .chat-container { background: rgba(30, 30, 30, 0.7); }
        body.dark-mode .bot-message .message-content { background: #333; color: var(--text-color); }
        body.dark-mode .chat-input { background-color: #2a2a2a; border-color: #444; color: var(--text-color); }
        body.dark-mode .skeleton { background: #2a2a2a; }
        body.dark-mode .skeleton::after { background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.08), rgba(255,255,255,0)); }
        body.dark-mode .stat-item, body.dark-mode .vision-mission-card { background: rgba(255, 255, 255, 0.05); border-color: rgba(255, 255, 255, 0.1); }
        body.dark-mode .stat-item h2 { color: var(--text-color); }

        body.dark-mode .portfolio-section h3,
        body.dark-mode .vision-mission-card h4,
        body.dark-mode .announcement-content h4,
        body.dark-mode .contact-item-content h4,
        body.dark-mode .stat-item i {
            color: var(--secondary-color);
        }
        body.dark-mode .hero-divider-t {
            background-color: var(--secondary-color);
        }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            color: var(--text-color);
            background: linear-gradient(135deg, #FFFBF5 0%, #FFF5E1 100%);
            background-attachment: fixed;
        }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--card-bg-color); display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease-out, visibility 0.5s ease-out; text-align: center; }
        #loader img { width: 100px; height: 100px; animation: pulsate 1.5s ease-in-out infinite; margin-bottom: 1rem; }
        #loader-text { color: var(--primary-color); font-weight: 600; font-size: 1.2rem; margin: 0; }
        @keyframes pulsate { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #loader.hidden { opacity: 0; visibility: hidden; }
        .portfolio-header { display: flex; justify-content: space-between; align-items: center; padding: 2.5rem 2rem; position: sticky; top: 0; z-index: 998; transition: all 0.5s ease-in-out; height: 50px; box-sizing: border-box; width: 95%; max-width: 1200px; margin: 0 auto; border-radius: 12px; background-color: transparent; }
        .portfolio-header img { transition: filter 0.4s ease; filter: brightness(0) invert(1); }
        .portfolio-header h1 { margin: 0; font-size: 1.5rem; color: var(--light-text-color); transition: color 0.4s ease, font-size 0.3s ease; }
        
        /* === DELETED old .main-nav styles === */
        
        #menu-toggle { color: var(--light-text-color); transition: color 0.4s ease; }
        .portfolio-header.header-scrolled { top: 1rem; background-color: rgba(255, 250, 240, 0.95); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 8px 20px rgba(0,0,0,0.07); border: 1px solid rgba(0,0,0,0.08); }
        .portfolio-header.header-scrolled img { filter: none; }
        .portfolio-header.header-scrolled h1 { color: var(--primary-color); }
        .portfolio-header.header-scrolled .main-nav a, .portfolio-header.header-scrolled #user-status { color: var(--text-color); }
        
        /* === DELETED old .main-nav:hover styles === */
        
        .portfolio-header.header-scrolled #menu-toggle { color: var(--primary-color); }
        .portfolio-header.header-scrolled #login-nav-btn a, .portfolio-header.header-scrolled #logout-nav-btn a,
        .portfolio-header.header-scrolled #login-nav-btn-desktop a, .portfolio-header.header-scrolled #logout-nav-btn-desktop a {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .portfolio-header-left { display: flex; align-items: center; }
        
        /* === DELETED old .main-nav ul/li styles === */

        .header-right { display: flex; align-items: center; }
        .login-btn { font-weight: 700; cursor: pointer; transition: all 0.2s ease-in-out; text-transform: uppercase; border-radius: 8px; text-decoration: none; color: var(--light-text-color); }
        .login-btn:hover { transform: translateY(-2px); }
        .hero-login-btn { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); color: var(--light-text-color); padding: 0.8rem 2.5rem; margin-top: 2.5rem; display: inline-block; }
        .hero-login-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .scroll-more-indicator { position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%); color: var(--light-text-color); font-size: 2.5rem; text-decoration: none; z-index: 10; transition: color 0.3s ease; }
        .scroll-more-indicator:hover { color: var(--secondary-color); }
        .scroll-more-indicator i { animation: bounceArrow 1.5s infinite; }
        @keyframes bounceArrow { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        #menu-toggle { display: none; }

        /* === START: NEW STYLES FOR HEADER LAYOUT === */
        .desktop-nav-links {
            display: block; /* Show by default */
        }
        .desktop-nav-links ul {
            margin: 0; 
            padding: 0; 
            list-style: none; 
            display: flex; 
            align-items: center;
        }
        .desktop-nav-links li {
            margin-left: 2rem;
        }
        .desktop-nav-links a {
            color: var(--light-text-color); 
            text-decoration: none; 
            font-weight: 600; 
            padding-bottom: 5px; 
            border-bottom: 2px solid transparent; 
            transition: color 0.4s ease, border-color 0.3s;
        }
        .desktop-nav-links a:hover {
            border-color: var(--light-text-color);
        }
        .portfolio-header.header-scrolled .desktop-nav-links a {
            color: var(--text-color);
        }
        .portfolio-header.header-scrolled .desktop-nav-links a:hover {
            color: var(--primary-color); 
            border-color: var(--primary-color);
        }

        .header-controls-desktop {
            list-style: none; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            align-items: center; 
            gap: 1.5rem; /* Spacing for login/logout */
            margin-left: 1rem; /* Space between menu and login */
        }
        
        /* Original main-nav is now mobile-only by default */
        .main-nav {
            display: none; /* Hide original nav on desktop */
        }
        /* === END: NEW STYLES FOR HEADER LAYOUT === */


        .hero-section { display: flex; justify-content: center; align-items: center; text-align: center; min-height: 100vh; padding: 2rem; position: relative; color: var(--light-text-color); background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('edit 2.jpg'); background-size: cover; background-position: center; margin-top: -130px; }
        .hero-content { z-index: 2; max-width: 800px; }
        .hero-greeting { font-size: 1.2rem; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin: 0; }
        .hero-title { font-size: 4rem; font-weight: 600; color: var(--light-text-color); margin: 0.5rem 0; line-height: 1.2; text-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .hero-divider { width: 80px; height: 4px; background-color: var(--light-text-color); margin: 1.5rem auto; }
        .hero-divider-t { width: 80px; height: 4px; background-color: #70160F; margin: 1.5rem auto; }
        .hero-description { font-size: 1.1rem; line-height: 1.7; color: rgba(255, 255, 255, 0.9); }
        .portfolio-container { max-width: 1200px; margin: auto; padding: 2rem; }
        .portfolio-section { background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.2); padding: 2.5rem; margin-bottom: 2rem; border-radius: 20px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); }
        .portfolio-section h3 { font-size: 2rem; color: var(--primary-color); text-align: center; margin-top: 0; margin-bottom: 2rem; }
        .section-title { font-size: 1.5rem; color: var(--primary-color); text-align: center; margin-top: 2rem; margin-bottom: 1.5rem; }
        .principal-card-container { display: flex; justify-content: center; margin-bottom: 2rem; }
        .principal-card-style h4, .teacher-card-style h4 { margin-top: 0.8rem; }
        .principal-card-style p, .teacher-card-style p { margin-top: 0.2rem; }

        /* New minimalist design for Administrator cards */
        #teachers-in-charge .prefect-card {
            background-color: #fdfdfd;
        }
        #teachers-in-charge .principal-card-style {
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        #teachers-in-charge .prefect-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 25px rgba(140, 28, 19, 0.1);
        }

        .vision-mission-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; list-style: none; padding: 0; margin-top: 2rem; }
        .vision-mission-card { background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); padding: 1.5rem; height: 100%; transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: left; }
        .vision-mission-card:hover { transform: translateY(-8px); box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15); }
        .vision-mission-card h4 { color: var(--primary-color); margin-top: 0; margin-bottom: 0.75rem; font-size: 1.1rem; border-bottom: 2px solid var(--secondary-color); padding-bottom: 0.5rem; }
        .vision-mission-card p { margin: 0; color: var(--text-light); font-size: 0.9rem; line-height: 1.6; }

        /* Stats Counter Section */
        .stats-container {
            display: flex;
            justify-content: space-around;
            text-align: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .stat-item {
            background: rgba(255, 255, 255, 0.4);
            padding: 2rem 1.5rem;
            border-radius: 12px;
            flex-basis: 250px;
            flex-grow: 1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.15);
        }
        .stat-item i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        .stat-item h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-color);
        }
        .stat-item p {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-light);
            margin: 0.5rem 0 0 0;
        }

        /* Announcements Section */
        .announcements-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .announcement-card {
            background: rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .announcement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 35px 0 rgba(0, 0, 0, 0.12);
        }
        .announcement-date {
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            text-align: center;
            padding: 10px;
            font-weight: 700;
            min-width: 60px;
        }
        .announcement-date .day {
            display: block;
            font-size: 1.8rem;
            line-height: 1;
        }
        .announcement-date .month {
            display: block;
            font-size: 0.8rem;
            text-transform: uppercase;
        }
        .announcement-icon {
            color: var(--primary-color);
            font-size: 2.5rem;
            padding: 0 10px;
        }
        .announcement-content h4 {
            margin: 0 0 0.5rem 0;
            color: var(--primary-color);
        }
        .announcement-content p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .prefects-layout { display: flex; gap: 2rem; }
        .prefects-sidebar { flex: 0 0 220px; }
        .prefects-sidebar h4 { margin-top: 0; color: var(--primary-color); border-bottom: 2px solid var(--secondary-color); padding-bottom: 0.5rem; }
        #category-filter-list { list-style: none; padding: 0; margin: 0; }
        #category-filter-list li button { width: 100%; padding: 0.8rem 1rem; margin-bottom: 0.5rem; border-radius: 8px; border: 1px solid transparent; background-color: rgba(0,0,0,0.02); text-align: left; font-weight: 600; font-size: 1rem; cursor: pointer; transition: all 0.3s; }
        #category-filter-list li button:hover { background-color: var(--secondary-color); color: var(--primary-color); transform: scale(1.03); }
        #category-filter-list li button.active { background-color: var(--primary-color); color: white; }
        .prefects-main-content { flex: 1; }
        .prefects-controls { margin-bottom: 1.5rem; }
        .prefects-controls input { width: 100%; box-sizing: border-box; padding: 0.8rem; border-radius: 8px; border: 1px solid #ddd; font-size: 1rem; }
        .prefects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        .prefect-card { background: #fff; border-radius: 12px; padding: 1rem; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.5s ease, transform 0.5s ease; opacity: 1; transform: translateY(0); }
        .prefect-card:hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
        .prefect-card img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--secondary-color); }
        .prefect-card h4 { margin: 0.8rem 0 0.2rem; font-size: 1rem; color: var(--text-color); }
        .prefect-card p { margin: 0; color: var(--primary-color); font-weight: 600; font-size: 0.9rem; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem; }
        .gallery-item { background: #fff; border-radius: 12px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); overflow: hidden; position: relative; transition: transform 0.3s ease, box-shadow 0.4s ease; }
        .gallery-item:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; display: block; transition: transform 0.4s ease; }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-item::after { content: '\f00e'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(140, 28, 19, 0.7); color: white; display: flex; justify-content: center; align-items: center; font-size: 2.5rem; opacity: 0; transition: opacity 0.4s ease; }
        .gallery-item:hover::after { opacity: 1; }

        /* --- Skeleton Loader --- */
        .skeleton {
            background: #e0e0e0;
            position: relative;
            overflow: hidden;
            border-radius: 12px;
        }
        .skeleton::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.5), rgba(255,255,255,0));
            animation: skeleton-loading 1.5s infinite;
        }
        @keyframes skeleton-loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .gallery-grid .skeleton { height: 250px; }
        .prefects-grid .skeleton { height: 190px; }

        .contact-layout { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; align-items: center; }
        .contact-details-list { list-style: none; padding: 0; }
        .contact-item { display: flex; align-items: flex-start; margin-bottom: 1rem; padding: 1rem; border-radius: 12px; transition: background-color 0.3s ease; }
        .contact-item:hover { background-color: rgba(0,0,0,0.03); }
        .contact-item:hover .icon { transform: scale(1.15); color: #70160F; }
        .contact-item .icon { font-size: 1.5rem; color: var(--primary-color); margin-right: 1.5rem; width: 30px; text-align: center; transition: transform 0.3s ease, color 0.3s ease; }
        .contact-item-content h4 { margin: 0 0 0.25rem 0; color: var(--primary-color); }
        .contact-item-content p, .contact-item-content a { margin: 0; color: var(--text-light); text-decoration: none; font-size: 0.9rem; }
        .contact-item-content a:hover { text-decoration: underline; }
        .contact-map iframe { width: 100%; height: 350px; border-radius: 12px; border: 0; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); }
        .show-more-container { text-align: center; margin-top: 1rem; display: flex; justify-content: center; gap: 1rem; }
        #show-more-teachers-btn, #show-less-teachers-btn, #show-more-btn, #show-less-btn { background-color: var(--primary-color); color: var(--light-text-color); border: none; padding: 0.8rem 2rem; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; text-transform: uppercase; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); letter-spacing: 0.5px; }
        #show-more-teachers-btn:hover, #show-less-teachers-btn:hover { background-color: #70160F; transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
        #show-less-teachers-btn { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); box-shadow: none; }
        #show-less-teachers-btn:hover { background-color: var(--primary-color); color: var(--light-text-color); transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
        .portfolio-footer { padding: 2.5rem 1rem; text-align: center; background: var(--card-bg-color); color: var(--text-light); border-top: 1px solid #eee; border-top-left-radius: 25px; border-top-right-radius: 25px; }
        .social-icons { display: flex; justify-content: center; gap: 1rem; margin-bottom: 1.5rem; }
        .social-icons a { color: var(--primary-color); background-color: rgba(140, 28, 19, 0.1); width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; text-decoration: none; border-radius: 50%; font-size: 1rem; transition: all 0.3s ease; }
        .social-icons a:hover { background-color: var(--primary-color); color: var(--light-text-color); transform: translateY(-5px); }
        .copyright-main { margin: 0.5rem 0; font-weight: 600; color: var(--text-color); }
        .copyright-credits { margin: 0; font-size: 0.8rem; color: var(--text-light); }

        /* Performance optimization: Hint to the browser about upcoming animations */
        .vision-mission-card,
        .prefect-card,
        .gallery-item,
        .social-icons a,
        .announcement-card,
        .stat-item,
        .theme-toggle-btn {
            will-change: transform, box-shadow;
        }

        .animate-on-scroll { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .animate-on-scroll.is-visible { opacity: 1; transform: translateY(0); }
        .animate-on-scroll.is-visible .animate-child { opacity: 1; transform: translateY(0); }
        .animate-child { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .testimonials-grid { 
            overflow-x: auto; 
            -webkit-overflow-scrolling: touch; 
            scrollbar-width: none; 
            -ms-overflow-style: none; 
            position: relative; 
            width: 100%; 
            cursor: grab;
        }
        .testimonials-grid.active {
            cursor: grabbing;
            cursor: -webkit-grabbing;
        }
        .testimonials-grid::before,
        .testimonials-grid::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 60px;
            z-index: 2;
            pointer-events: none;
        }
        .testimonials-grid::before {
            left: 0;
            background: linear-gradient(to right, var(--card-bg-color, #FFFAF0) 30%, rgba(255, 250, 240, 0));
        }
        .testimonials-grid::after {
            right: 0;
            background: linear-gradient(to left, var(--card-bg-color, #FFFAF0) 30%, rgba(255, 250, 240, 0));
        }
        .testimonials-grid::-webkit-scrollbar { display: none; }
        .testimonials-scroller { display: flex; gap: 1.5rem; padding-bottom: 1rem; flex-wrap: nowrap; }
        .testimonial-card { background: var(--card-bg-color); padding: 2rem; border-radius: 12px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: transform 0.3s ease, box-shadow 0.3s ease; min-width: 280px; flex-basis: 280px; flex-shrink: 0; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .testimonial-card:hover { transform: translateY(-8px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
        .testimonial-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 4px solid var(--secondary-color); margin-bottom: 1rem; }
        .testimonial-card h4 { margin: 0 0 0.5rem 0; color: var(--primary-color); }
        .testimonial-card .quote { font-style: italic; color: var(--text-light); margin: 0; position: relative; }
        .testimonial-card .quote::before { content: '“'; font-family: Georgia, serif; font-size: 2.5rem; position: absolute; top: -10px; left: -15px; color: var(--secondary-color); opacity: 0.8; }
        .testimonial-card .quote::after { content: '”'; font-family: Georgia, serif; font-size: 2.5rem; position: absolute; bottom: -25px; right: -15px; color: var(--secondary-color); opacity: 0.8; }
        .testimonial-card h4:nth-of-type(1) {
            margin-bottom: 0.1rem;
        }
        .testimonial-card h4:nth-of-type(2) {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0;
            font-weight: 400;
        }
        .creators-fab { position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; background-color: var(--primary-color); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); cursor: pointer; z-index: 990; animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-chat-fab { 0% { border-radius: 50%; } 50% { border-radius: 20%; } 100% { border-radius: 50%; } }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            opacity: 0; /* Start hidden */
            transition: opacity 0.3s ease-in-out; /* Fade transition */
        }
        .modal.show {
            opacity: 1; /* Fade in */
        }
        .modal-content-wrapper {
            /* This is a generic wrapper. Specific modals will style it. */
            min-height: 100%;
        }
        /* Restore centering specifically for the auth modal */
        #auth-modal .modal-content-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .auth-card { background: rgba(255, 250, 240, 0.75); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 10px 35px rgba(0, 0, 0, 0.1); padding: 2.5rem; border-radius: 20px; width: 100%; max-width: 420px; margin: 1rem; }
        
        /* Reposition close button for drawer */
        .creators-card .close-button { 
            position: absolute; 
            top: 15px; 
            right: 20px; 
            color: #555; 
            font-size: 32px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: color 0.3s, transform 0.3s;
            z-index: 10;
        }
        .creators-card .close-button:hover { color: #000; transform: rotate(90deg); }

        @keyframes fadeInScaleUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        /* The login modal still uses this */
        #auth-modal .modal-content-wrapper > .auth-card { animation: fadeInScaleUp 0.4s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }

        /* --- NEW CREATORS DRAWER STYLES --- */
        .creators-card {
            position: fixed;
            top: 0;
            right: -100%; /* Start off-screen */
            width: 100%;
            max-width: 380px;
            height: 100vh;
            margin: 0;
            border-radius: 0;
            background: rgba(255, 250, 240, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: -10px 0 40px rgba(0,0,0,0.15);
            text-align: center;
            overflow-y: auto;
            transition: right 0.5s cubic-bezier(0.77, 0, 0.175, 1);
            padding: 2.5rem 1.5rem;
        }

        #creators-modal.show .creators-card {
            right: 0; /* Slide in */
        }

        .creators-card h3 { margin-bottom: 2.5rem; font-size: 1.8rem; color: var(--primary-color); }
        .developer-cards-container { 
            display: flex; 
            flex-direction: column;
            align-items: center;
            gap: 1.5rem; 
        }

        /* --- NEW: Animated Atomic Background for Drawer --- */
        .creators-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.3;
            background-image: 
                url("data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' stroke='%238C1C13' stroke-width='1'%3e%3ccircle cx='50' cy='50' r='5'/%3e%3cellipse cx='50' cy='50' rx='40' ry='15'/%3e%3c/g%3e%3ccircle r='3' fill='%238C1C13'%3e%3canimateMotion dur='4s' repeatCount='indefinite' path='M10,50 a40,15 0 1,0 80,0 a40,15 0 1,0 -80,0'/%3e%3c/circle%3e%3c/svg%3e"),
                url("data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' stroke='%238C1C13' stroke-width='1'%3e%3ccircle cx='50' cy='50' r='5'/%3e%3cellipse cx='50' cy='50' rx='40' ry='15' transform='rotate(60 50 50)'/%3e%3c/g%3e%3ccircle r='3' fill='%238C1C13'%3e%3canimateMotion dur='3.5s' repeatCount='indefinite' path='M10,50 a40,15 0 1,0 80,0 a40,15 0 1,0 -80,0' transform='rotate(60 50 50)'/%3e%3c/circle%3e%3c/svg%3e"),
                url("data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3cg fill='none' stroke='%238C1C13' stroke-width='1'%3e%3ccircle cx='50' cy='50' r='5'/%3e%3cellipse cx='50' cy='50' rx='15' ry='40' transform='rotate(-30 50 50)'/%3e%3c/g%3e%3ccircle r='3' fill='%238C1C13'%3e%3canimateMotion dur='5s' repeatCount='indefinite' path='M50,10 a15,40 0 1,0 0,80 a15,40 0 1,0 0,-80' transform='rotate(-30 50 50)'/%3e%3c/circle%3e%3c/svg%3e");
            background-repeat: no-repeat, no-repeat, no-repeat;
            background-position: 10% 20%, 80% 40%, 30% 80%;
            background-size: 100px, 80px, 120px;
            animation: move-atoms 20s linear infinite;
            z-index: -1;
        }

        @keyframes move-atoms {
            0% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-20px) translateX(10px); }
            100% { transform: translateY(0) translateX(0); }
        }

        /* --- NEW: Custom Scrollbar for Drawer --- */
        .creators-card::-webkit-scrollbar {
            width: 8px;
        }
        .creators-card::-webkit-scrollbar-track {
            background: transparent;
        }
        .creators-card::-webkit-scrollbar-thumb {
            background-color: var(--secondary-color);
            border-radius: 4px;
        }
        .creators-card::-webkit-scrollbar-thumb:hover {
            background-color: var(--primary-color);
        }
        /* --- NEW: Accordion Styles for Developer List --- */
        .developer-accordion-item {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .developer-accordion-item:hover {
            background: rgba(255, 255, 255, 0.7);
        }
        .developer-accordion-header {
            display: flex;
            align-items: center;
            padding: 1rem;
            cursor: pointer;
        }
        .developer-accordion-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 1rem;
            border: 2px solid var(--secondary-color);
        }
        .developer-accordion-header .developer-info {
            flex-grow: 1;
            text-align: left;
        }
        .developer-accordion-header h4 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--text-color);
        }
        .developer-accordion-header .role {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        .accordion-icon {
            font-size: 1rem;
            color: var(--text-light);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin-left: auto; /* Push icon to the right */
            padding-left: 1rem; /* Add some space */
        }
        .developer-accordion-item.active .accordion-icon {
            transform: rotate(180deg);
            color: var(--primary-color);
        }
        .developer-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
            padding: 0 1rem;
        }
        .developer-accordion-item.active .developer-accordion-content {
            max-height: 200px; /* Adjust as needed */
            padding-bottom: 1rem;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        .developer-accordion-content .dev-skills {
            padding: 0.8rem 0;
            margin: 0;
            border-top: 1px solid rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            gap: 1rem;
            font-size: 1.5rem;
        }
        .developer-accordion-content .dev-social-icons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding-top: 0.5rem;
        }
        .modal.visible .developer-card {
            opacity: 1;
            transform: perspective(1000px) translateY(0);
        }
        .modal.visible .developer-card:nth-child(1) { transition-delay: 200ms; }
        .modal.visible .developer-card:nth-child(2) { transition-delay: 350ms; }
        .modal.visible .developer-card:nth-child(3) { transition-delay: 500ms; }
        .developer-card img {
            width: 80px; /* Reduced image size */
            height: 80px; /* Reduced image size */
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid transparent;
            background-image: linear-gradient(white, white), linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            background-origin: border-box;
            background-clip: content-box, border-box;
            margin-bottom: 0.8rem; /* Reduced margin */
            transform: translateZ(40px);
        }
        .developer-card h4 { transform: translateZ(30px); margin-bottom: 0.2rem; } /* Reduced margin */
        .developer-card .role {
            font-size: 0.85rem; /* Slightly smaller font */
            color: var(--text-light);
            margin: 0;
        }
        .dev-skills {
            padding: 0.8rem 0; /* Reduced padding */
            margin: 0.8rem 0; /* Reduced margin */
            border-top: 1px solid rgba(140, 28, 19, 0.2);
            display: flex;
            justify-content: center;
            gap: 0.8rem; /* Reduced gap */
            font-size: 1.4rem; /* Reduced font size */
        }
        .dev-skills i {
            color: var(--text-light);
            transition: color 0.3s ease, transform 0.3s ease;
            cursor: help;
        }
        .dev-skills i:hover {
            color: var(--primary-color);
            transform: scale(1.2);
        }
        .dev-social-icons { display: flex; justify-content: center; gap: 0.8rem; } /* Reduced gap */
        .dev-social-icons a { color: var(--text-light); font-size: 1.1rem; /* Slightly larger font */ width: 30px; /* Reduced width */ height: 30px; /* Reduced height */ display: flex; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.05); border-radius: 50%; text-decoration: none; transition: all 0.3s ease; }
        .element-hidden { display: none; }
        .toast-notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: var(--success-color); color: white; padding: 12px 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); font-weight: 600; z-index: 1001; visibility: hidden; opacity: 0; transition: all 0.4s ease-in-out; }
        .toast-notification.show { visibility: visible; animation: toast-in-out 3s ease-in-out forwards; }
        @keyframes toast-in-out { 0% { opacity: 0; transform: translate(-50%, -40px); } 15%, 85% { opacity: 1; transform: translate(-50%, 0); } 100% { opacity: 0; transform: translate(-50%, -40px); } }

        /* --- START: Redesigned Auth Modal Styles --- */
        #auth-modal .auth-card {
            padding: 2rem;
        }
        #auth-modal #auth-form {
            gap: 0.75rem; /* Reduce gap slightly */
        }
        #auth-modal input[type="email"], 
        #auth-modal input[type="password"] {
            background-color: #eee;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 14px 15px;
            margin: 5px 0;
            width: 100%;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #auth-modal input[type="email"]:focus, 
        #auth-modal input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(140, 28, 19, 0.15);
        }
        #auth-modal #auth-submit-btn {
            border-radius: 20px;
            border: 1px solid var(--primary-color);
            background-color: var(--primary-color);
            color: var(--light-text-color);
            font-size: 12px;
            font-weight: bold;
            padding: 14px 45px;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: transform 80ms ease-in, background-color 0.3s;
            cursor: pointer;
            margin-top: 10px;
        }
        #auth-modal #auth-submit-btn:hover {
            background-color: var(--primary-color-dark);
        }
        #auth-modal #auth-submit-btn:active {
            transform: scale(0.95);
        }
        /* --- END: Redesigned Auth Modal Styles --- */

        /* --- Style for the new Auth Modal Close Icon --- */
        #auth-modal .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            border-radius: 50%;
            color: #888;
            font-size: 1rem; /* Adjust icon size */
            font-weight: normal; /* Reset bold from generic style */
            transition: all 0.3s ease;
            z-index: 10;
        }
        #auth-modal .close-button:hover {
            background-color: var(--primary-color);
            color: white;
            transform: rotate(90deg);
        }

        /* --- Theme Toggle Button --- */
        .theme-toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .portfolio-header.header-scrolled .theme-toggle-btn {
            background: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }
        .portfolio-header.header-scrolled .theme-toggle-btn i {
             color: var(--primary-color);
        }

        .theme-toggle-btn:hover {
            transform: scale(1.1);
        }
        .theme-toggle-btn i {
            position: absolute;
            font-size: 1rem;
            transition: transform 0.4s ease, opacity 0.4s ease;
            color: white;
        }
        .theme-toggle-btn .fa-sun {
            transform: translateY(200%);
            opacity: 0;
            color: #f39c12;
        }
        .theme-toggle-btn .fa-moon {
            transform: translateY(0);
            opacity: 1;
        }
        /* Dark mode icon states */
        body.dark-mode .theme-toggle-btn .fa-sun {
            transform: translateY(0);
            opacity: 1;
        }
        body.dark-mode .theme-toggle-btn .fa-moon {
            transform: translateY(-200%);
            opacity: 0;
        }

        /* Mobile Button */
        .theme-toggle-btn-mobile {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            padding: 1rem;
            width: 100%;
            text-align: center;
            cursor: pointer;
        }

        @media (max-width: 992px) {
            /* === START: NEW MOBILE HEADER STYLES === */
            .desktop-nav-links,
            .header-controls-desktop {
                display: none; /* Hide desktop menu and controls on mobile */
            }
            
            .main-nav {
                display: block; /* Show original nav (for mobile dropdown) */
                /* All the existing mobile styles for .main-nav will now apply */
                position: absolute; 
                top: 130px; 
                left: 0; 
                width: 100%; 
                background-color: rgba(255, 250, 240, 0.7); 
                backdrop-filter: blur(25px); 
                -webkit-backdrop-filter: blur(25px); 
                box-shadow: 0 12px 30px rgba(0,0,0,0.2); 
                z-index: 100; 
                max-height: 0; 
                opacity: 0; 
                overflow: hidden; 
                transition: max-height 0.4s ease-out, opacity 0.4s ease-out;
            }
            /* === END: NEW MOBILE HEADER STYLES === */

            .contact-layout { grid-template-columns: 1fr; }
            /* .main-nav { ... MOVED UP ... } */
            .main-nav.mobile-nav-active { max-height: 30rem; opacity: 1; }
            .main-nav ul { flex-direction: column; padding: 1rem 0; align-items: center; margin: 0; list-style: none; }
            .main-nav li { margin: 0; text-align: center; }
            .main-nav a { display: block; padding: 1rem; border: none; text-decoration: none; font-weight: 600; }
            .portfolio-header.header-scrolled .main-nav a, .portfolio-header:not(.header-scrolled) .main-nav a, .portfolio-header.header-scrolled #user-status, .portfolio-header:not(.header-scrolled) #user-status { color: var(--text-color); }
            #login-nav-btn, #logout-nav-btn, #user-status { margin: 0.5rem 0 !important; }
            #user-email { padding-right: 1rem; }
            #menu-toggle { display: block; position: relative; background: none; border: none; cursor: pointer; margin-left: 1rem; width: 28px; height: 22px; z-index: 101; transition: .5s ease-in-out; }
            #menu-toggle span { display: block; position: absolute; height: 3px; width: 100%; background: var(--light-text-color); border-radius: 3px; opacity: 1; left: 0; transform: rotate(0deg); transition: .25s ease-in-out; }
            .portfolio-header.header-scrolled #menu-toggle span { background: var(--primary-color); }
            #menu-toggle span:nth-child(1) { top: 0px; }
            #menu-toggle span:nth-child(2) { top: 9px; }
            #menu-toggle span:nth-child(3) { top: 18px; }
            #menu-toggle.active span:nth-child(1) { top: 9px; transform: rotate(135deg); }
            #menu-toggle.active span:nth-child(2) { opacity: 0; left: -30px; }
            #menu-toggle.active span:nth-child(3) { top: 9px; transform: rotate(-135deg); }
            .portfolio-header { justify-content: space-between; }
        }
        @media (max-width: 768px) {
            .portfolio-section { padding: 1.5rem; text-align: center; }
            .portfolio-section h3 { font-size: 1.8rem; margin-bottom: 1.5rem; }
            .vision-mission-list { grid-template-columns: 1fr; }
            .vision-mission-card { text-align: center; }
            .vision-mission-card h4 { border-bottom: none; padding-bottom: 0; margin-bottom: 0.5rem; }
            .portfolio-header h1 { display: none; }
            .hero-section { padding: 2rem 1rem; }
            .hero-title { font-size: 2.8rem; }
            .hero-greeting { font-size: 1rem; }
            .hero-description { font-size: 0.9rem; }
            .container, .portfolio-container { padding: 1rem; }
            .prefects-layout { flex-direction: column; }
            .prefects-sidebar { flex: 0 0 auto; margin-bottom: 2rem; }
            #category-filter-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; }
            #category-filter-list li button { width: auto; flex-grow: 1; }
            .prefects-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
            .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
            .contact-layout { grid-template-columns: 1fr; }
            .contact-item { justify-content: center; text-align: center; flex-direction: column; align-items: center; }
            .contact-item .icon { margin-right: 0; margin-bottom: 0.5rem; }
            .developer-cards-container { flex-direction: column; align-items: center; }
            .developer-card { max-width: 300px; }
        }
        @media (max-width: 480px) {
            .portfolio-header { padding: 1rem; height: auto; }
            .portfolio-header img { height: 40px; margin-right: 10px; }
            .hero-section { min-height: 100vh; padding: 1.5rem 0.5rem; }
            .hero-title { font-size: 2rem; }
            .hero-greeting { font-size: 0.9rem; }
            .hero-description { font-size: 0.8rem; }
            .hero-login-btn { padding: 0.6rem 2rem; margin-top: 1.5rem; font-size: 0.9rem; }
            .portfolio-container { padding: 0.5rem; }
            .portfolio-section { padding: 1rem; margin-bottom: 1.5rem; }
            .portfolio-section h3 { font-size: 1.5rem; margin-bottom: 1rem; }
            .prefects-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; }
            .prefect-card img { width: 80px; height: 80px; }
            .prefect-card h4 { font-size: 0.9rem; }
            .prefect-card p { font-size: 0.8rem; }
            .gallery-grid { grid-template-columns: 1fr; gap: 1rem; }
            .gallery-item img { height: 200px; }
            .contact-map iframe { height: 250px; }
            .contact-item { margin-bottom: 1.5rem; }
            .testimonial-card { padding: 1.5rem; }
            .testimonial-card img { width: 60px; height: 60px; }
            .testimonial-card h4 { font-size: 1rem; }
            .testimonial-card .quote { font-size: 0.9rem; }
            .developer-card { min-width: unset; max-width: 90%; }
            .social-icons a { width: 35px; height: 35px; font-size: 0.9rem; }
            .copyright-main { font-size: 0.9rem; }
            .copyright-credits { font-size: 0.7rem; }
        }
        .chat-fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background-color: var(--primary-color); color: var(--light-text-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 995; transition: all 0.3s ease; animation: pulse-chat-fab 2s infinite ease-in-out; border: none; }
        .chat-fab:hover { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); }
        .chat-container { position: fixed; bottom: 90px; right: 20px; width: 350px; height: 400px; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border-radius: 15px; box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16); display: none; flex-direction: column; z-index: 995; animation: slideUp 0.3s ease-out; }
        .chat-container.active { display: flex; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .chat-header { background: var(--primary-color); color: var(--light-text-color); padding: 1rem; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .chat-header h3 { margin: 0; font-size: 1.1rem; }
        .chat-close { background: none; border: none; color: var(--light-text-color); font-size: 1.5rem; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .message { display: flex; margin-bottom: 0.5rem; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bot-message { justify-content: flex-start; }
        .user-message { justify-content: flex-end; }
        .message-content { max-width: 70%; padding: 0.75rem 1rem; border-radius: 12px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .bot-message .message-content { background: #f0f0f0; color: var(--text-color); }
        .user-message .message-content { background: var(--primary-color); color: var(--light-text-color); }
        .chat-input-area { padding: 1rem; border-top: 1px solid #eee; display: flex; gap: 0.5rem; }
        .chat-input { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 0.75rem 1rem; font-size: 0.9rem; font-family: 'Poppins', sans-serif; transition: border-color 0.3s ease; }
        .chat-input:focus { outline: none; border-color: var(--primary-color); }
        .chat-send { background: var(--primary-color); color: var(--light-text-color); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .chat-send:hover { transform: scale(1.05); background: #70160F; }
        @media (max-width: 480px) {
            .chat-container { width: calc(100% - 20px); height: 70vh; bottom: 80px; right: 10px; left: 10px; margin: 0; border-radius: 15px; }
            .message-content { max-width: 85%; }
        }

        @media (max-width: 768px) {
            .creators-card {
                max-width: 95%;
                margin: 1rem auto;
                padding: 1.5rem;
            }
            .developer-cards-container {
                flex-direction: column;
                align-items: center;
                gap: 1.5rem;
            }
            .developer-card {
                min-width: unset;
                max-width: 300px;
                width: 90%;
            }
        }

        @media (max-width: 480px) {
            .modal-content-wrapper {
                align-items: flex-start; /* Align to top on very small screens */
                padding-top: 1rem;
            }
            .creators-card {
                max-width: 95%;
                width: 95%; /* Ensure it takes up width */
                margin: 0.5rem auto; /* Smaller margin */
                padding: 1rem;
            }
            .developer-card {
                width: 100%;
                max-width: 280px; /* Slightly smaller max-width for cards */
            }
            .dev-skills {
                font-size: 1.2rem; /* Further reduced font size */
                gap: 0.6rem;
            }
            .dev-social-icons a {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            .creators-card h3 {
                font-size: 1.5rem; /* Smaller heading */
            }
        }

        .background-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .background-particles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(140, 28, 19, 0.15);
            border-radius: 50%;
            animation: particle-animation 25s linear infinite;
            bottom: -150px;
        }

        .background-particles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .background-particles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .background-particles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .background-particles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .background-particles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .background-particles li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .background-particles li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .background-particles li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .background-particles li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .background-particles li:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes particle-animation {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.8;
                border-radius: 50%;
            }
            20% {
                transform: translateY(-20vh) translateX(5vw) rotate(144deg);
            }
            40% {
                transform: translateY(-40vh) translateX(-5vw) rotate(288deg);
            }
            60% {
                transform: translateY(-60vh) translateX(8vw) rotate(432deg);
            }
            80% {
                transform: translateY(-80vh) translateX(-3vw) rotate(576deg);
            }
            100% {
                transform: translateY(-105vh) translateX(0) rotate(720deg);
                opacity: 0;
                border-radius: 25%;
            }
        }

        /* --- Gallery Lightbox --- */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 1000;
            padding-top: 60px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
            transition: opacity 0.4s ease;
        }
        .lightbox-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            animation-name: zoom;
            animation-duration: 0.6s;
        }
        @keyframes zoom {
            from {transform:scale(0)}
            to {transform:scale(1)}
        }
        .lightbox-close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        .lightbox-close:hover,
        .lightbox-close:focus {
            color: #bbb;
            text-decoration: none;
        }
        .lightbox-prev, .lightbox-next {
          cursor: pointer;
          position: absolute;
          top: 50%;
          width: auto;
          padding: 16px;
          margin-top: -50px;
          color: white;
          font-weight: bold;
          font-size: 20px;
          transition: 0.6s ease;
          border-radius: 0 3px 3px 0;
          user-select: none;
          -webkit-user-select: none;
        }
        .lightbox-next {
          right: 0;
          border-radius: 3px 0 0 3px;
        }
        .lightbox-prev:hover, .lightbox-next:hover {
          background-color: rgba(255,255,255,0.2);
        }
        #lightbox-caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
        }
    </style>
</head>
<body>
<ul class="background-particles">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
</ul>

    <div id="loader">
        <div>
            <img src="meroon Transparent logo prefect.png" alt="Loading...">
            <p id="loader-text">Loading...</p>
        </div>
    </div>
    
    <div id="success-toast" class="toast-notification"></div>

    <div id="public-portfolio">
        
        <header class="portfolio-header" id="portfolio-header">
            <div class="portfolio-header-left">
                <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 50px; margin-right: 15px;">
            </div>
            
            <nav class="desktop-nav-links">
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#about-us">About Us</a></li>
                    <li><a href="#teachers-in-charge">Teachers</a></li>
                    <li><a href="#testimonials">Comments</a></li>
                    <li><a href="#prefects-list">Prefects</a></li>
                    <li><a href="#gallery">Gallery</a></li>
                    <li><a href="#contact">Contact Us</a></li>
                </ul>
            </nav>
            
            <div class="header-right">
                <ul class="header-controls-desktop">
                    <li>
                        <button id="theme-toggle-btn-desktop" class="theme-toggle-btn" title="Toggle theme">
                            <i class="fas fa-moon"></i>
                            <i class="fas fa-sun"></i>
                        </button>
                    </li>
                    <li id="user-status-desktop" style="display: none; align-items: center; color: white;">
                        <span id="user-email-desktop" style="font-weight: 500; font-size: 0.9rem;"></span>
                    </li>
                    <li id="login-nav-btn-desktop">
                        <a href="#" class="login-btn" style="border: 1px solid white; padding: 8px 15px; border-radius: 5px;">Login</a>
                    </li>
                    <li id="logout-nav-btn-desktop" style="display: none;">
                        <a href="#" class="login-btn" style="border: 1px solid white; padding: 8px 15px; border-radius: 5px;">Logout</a>
                    </li>
                </ul>
                
                <nav class="main-nav" id="main-nav">
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#about-us">About Us</a></li>
                        <li><a href="#teachers-in-charge">Teachers</a></li>
                        <li><a href="#testimonials">Comments</a></li>
                        <li><a href="#prefects-list">Prefects</a></li>
                        <li><a href="#gallery">Gallery</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                        <li>
                            <button id="theme-toggle-btn-mobile" class="theme-toggle-btn-mobile" title="Toggle theme">
                                Toggle Theme
                            </button>
                        </li>
                        <li id="user-status" style="display: none; align-items: center; color: white;">
                            <span id="user-email" style="font-weight: 500; font-size: 0.9rem;"></span>
                        </li>
                        <li id="login-nav-btn">
                            <a href="#" class="login-btn" style="border: 1px solid white; padding: 8px 15px; border-radius: 5px;">Login</a>
                        </li>
                        <li id="logout-nav-btn" style="display: none;">
                            <a href="#" class="login-btn" style="border: 1px solid white; padding: 8px 15px; border-radius: 5px;">Logout</a>
                        </li>
                    </ul>
                </nav>
                <button id="menu-toggle" aria-label="Toggle Menu"><span></span><span></span><span></span></button>
            </div>
        </header>
        <section class="hero-section animate-on-scroll" id="hero">
             <div class="hero-content">
                <p class="hero-greeting">Welcome to the</p>
                <h2 class="hero-title">ECC PREFECTS' GUILD</h2>
                <div class="hero-divider"></div>
                <p class="hero-description">Leading with integrity and dedication. We are committed to upholding the values of our college and serving the student community.</p>
                <a href="login.html" class="login-btn hero-login-btn">Login As Prefect</a>
            </div>
            <a href="#about-us" class="scroll-more-indicator">
                <i class="fas fa-chevron-down"></i>
            </a>
        </section>

        <div class="portfolio-container">
            <section id="about-us" class="portfolio-section animate-on-scroll">
                <h3>About Us</h3>
                <p style="text-align: center;">As the Prefects' Guild of Eheliyagoda Central College, our primary objectives are:</p>
                <ul class="vision-mission-list">
                    <li class="vision-mission-card animate-child">
                        <h4>Our Vision</h4>
                        <p>Our main vision is to provide proper guidance and support to the entire student community by setting an example of leadership.</p>
                    </li>
                    <li class="vision-mission-card animate-child">
                        <h4>Maintaining Discipline</h4>
                        <p>We are dedicated to maintaining the school's discipline at a high level and encouraging students to wear the uniform correctly and neatly.</p>
                    </li>
                    <li class="vision-mission-card animate-child">
                        <h4>Core Duties</h4>
                        <p>We are committed to performing our duties at the main gate, during morning assemblies, and at all other special school events.</p>
                    </li>
                </ul>
            </section>

            <section id="stats-counter" class="portfolio-section animate-on-scroll">
                <h3>Our Community In Numbers</h3>
                <div class="stats-container">
                    <div class="stat-item animate-child">
                        <i class="fas fa-user-shield"></i>
                        <h2 class="counter" data-target="56">0</h2>
                        <p>Senior Prefects</p>
                    </div>
                    <div class="stat-item animate-child">
                        <i class="fas fa-user-graduate"></i>
                        <h2 class="counter" data-target="76">0</h2>
                        <p>Junior Prefects</p>
                    </div>
                    <div class="stat-item animate-child">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <h2 class="counter" data-target="24">0</h2>
                        <p>Teachers in Charge</p>
                    </div>
                </div>
            </section>

            <section id="announcements" class="portfolio-section animate-on-scroll">
                <h3>Announcements & Events</h3>
                <div class="announcements-container">
                    <div class="announcement-card animate-child">
                        <div class="announcement-date">
                            <span class="day">28</span>
                            <span class="month">OCT</span>
                        </div>
                        <div class="announcement-content">
                            <h4>Annual General Meeting</h4>
                            <p>The Annual General Meeting of the Prefects' Guild will be held at the main auditorium. All prefects are requested to attend.</p>
                        </div>
                    </div>
                    <div class="announcement-card animate-child">
                        <div class="announcement-date">
                            <span class="day">15</span>
                            <span class="month">NOV</span>
                        </div>
                        <div class="announcement-content">
                            <h4>Leadership Workshop</h4>
                            <p>A leadership workshop for all senior and junior prefects will be conducted. Venue: School Library.</p>
                        </div>
                    </div>
                    <div class="announcement-card animate-child">
                         <div class="announcement-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="announcement-content">
                            <h4>Special Notice</h4>
                            <p>Please note that there will be no morning assembly next Monday due to scheduled maintenance work.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="teachers-in-charge" class="portfolio-section animate-on-scroll">
                <h3>Administrators</h3>
                <div class="hero-divider-t"></div>
                <h3 class="section-title">Principal</h3>
                <div class="principal-card-container">
                    <div class="prefect-card animate-child principal-card-style">
                        <h4>Mrs. Shriyani Kusum Dissanayake</h4>
                        <p>Principal</p>
                    </div>
                </div>

                <h3 class="section-title">Teachers in Charge</h3>
                <div class="prefects-grid" id="teachers-grid">
                    <div class="prefect-card animate-child teacher-card-style"><h4>W.A. Lasantha Weerasinghe</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>K.K. Kusum Malani</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>R.A.P.S. Rajapaksha</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>M.H. Janitha Chandani</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>R.P. Pramila Jayarathna</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>K.N.B.B.M. Lahiru Bandaranayake</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>D.G.A. Damith Weerasinghe</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>S.K. Upeksha Sewwandi</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>J.L. Nishanthimala</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>S.G.T.P.O. Ranasinghe</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>J.M. Deepani Jayaruwan</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>J.A.S.K. Jayasinghe</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>W.M. Janaki Rathnayake</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>W.M. Mihiri Weerasinghe</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>K.A.K. Saman Priyadarshana</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>D.M. Ruwan Dasanayaka</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>Y. Desika Kumari</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>H.P.S. Nishani</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>H.A.V.S. Jayawardhana</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>M.D.A.I. Kumara</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>A.P. Buddika Mihirani</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>M.M. Fathima Maheesha</h4><p>Teacher in Charge</p></div>
                    <div class="prefect-card animate-child teacher-card-style"><h4>P.R.I. Vihara Hemarathna</h4><p>Teacher in Charge</p></div>
                </div>
                <div class="show-more-container" id="teachers-show-more-container">
                    <button id="show-more-teachers-btn">Show More</button>
                    <button id="show-less-teachers-btn" style="display: none;">Show Less</button>
                </div>
            </section>
            <section id="testimonials" class="portfolio-section animate-on-scroll">
                <h3>What Our Students Say</h3>
                <div class="testimonials-grid">
                    <div class="testimonials-scroller">
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/Piyumira.jpg" alt="Piyumira Manahari" loading="lazy">
                                                    <h4>Piyumira Manahari</h4>
                                                    <h4>Head prefect In 2021 / 2022</h4>
                                                    <p class="quote">Being part of the Prefects’ Guild was an experience that truly shaped my growth and leadership. It’s inspiring to see the Guild continue guiding and empowering students to lead with dedication, teamwork, and integrity.</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/Ranindu.jpg" alt="Ranindu Hansaka" loading="lazy">
                                                    <h4>Ranindu Hansaka</h4>
                                                    <h4>D.H.P. In 2024 / 2025</h4>
                                                    <p class="quote">A leader is not someone who always goes ahead...he goes with others towards the same goal, towards the same dream. We have the same goal in our hearts, to elevate the name of the school. I am honored to be a part of this board, to walk this journey with love, dedication, and unity.</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/1323.png" alt="Raveena Weerashinghe" loading="lazy">
                                                    <h4>Raveena Weerashinghe </h4>
                                                    <h4>Senior probationary prefect</h4>
                                                    <p class="quote">Proud to be part of a prefect board that shapes leadership,discipline and teamwork. A standard of excellent that continues with new things🎀✨</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/Akarsha.jpg" alt="Akarsha Kamburapola" loading="lazy">
                                                    <h4>Akarsha Kamburapola</h4>
                                                    <h4>Head prefect in 2024</h4>
                                                    <p class="quote">I was fortunate to join the prefect guild of R/Eheliyagoda Central College, which has taught me to balance all aspects with the discipline that is essential to life, work with appropriate wisdom, and strive towards goals.</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/Rashmi.png" alt="Rashmi Jananjana" loading="lazy">
                                                    <h4>Rashmi Jananjana</h4>
                                                    <h4>D.H.P. 2024</h4>
                                                    <p class="quote">becoming a part of prefect board at Eheliyagoda Central College was a great achievement in my life and a source of pride for me, through which I learned that taking responsibility is an essential quality in life.</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/aritha.jpg" alt="Aritha Dasanayake" loading="lazy">
                                                    <h4>Aritha Dasanayake</h4>
                                                    <h4>Head Prefect in 2024/2025</h4>
                                                    <p class="quote">I’m truly proud to be a part of the Eheliyagoda Central College Prefect Guild. 💙 This guild represents leadership, discipline, and dedication in every step we take. Being a prefect isn’t just about wearing a badge — it’s about setting an example for others.</p>
                                                </div>
                                                <div class="testimonial-card animate-child">
                                                    <img src="Comment section/nrthmi.png" alt="Nethmi Dananjana" loading="lazy">
                                                    <h4>Nethmi Dananjana</h4>
                                                    <h4>Sectional Head in 2024</h4>
                                                    <p class="quote">I’m truly happy and proud to represent a key position in the Student Council of Eheliyagoda National School. Every challenge we face helps us grow into stronger and more responsible leaders. We have an amazing team that carries out every task with dedication and excellence</p>
                                                </div>

                    </div>
                </div>
            </section>

            <section id="prefects-list" class="portfolio-section animate-on-scroll">
                <h3>Our Prefects</h3>
                <div class="prefects-layout">
                    <div class="prefects-sidebar">
                        <h4>Categories</h4>
                        <ul id="category-filter-list"></ul>
                    </div>
                    <div class="prefects-main-content">
                         <div class="prefects-controls">
                            <input type="search" id="prefect-search-bar" placeholder="Search by name...">
                        </div>
                        <div id="prefects-grid" class="prefects-grid">
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                            <div class="skeleton"></div>
                        </div>
                        <div class="show-more-container">
                            <button id="show-more-btn">Show More</button>
                            <button id="show-less-btn">Show Less</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="gallery" class="portfolio-section animate-on-scroll">
                <h3>Gallery</h3>
                <div class="gallery-grid" id="gallery-grid-public">
                    <div class="skeleton"></div>
                    <div class="skeleton"></div>
                    <div class="skeleton"></div>
                    <div class="skeleton"></div>
                </div>
            </section>

            <section id="contact" class="portfolio-section animate-on-scroll">
                <h3>Contact Us</h3>
                <div class="contact-layout">
                    <div class="contact-details">
                        <ul class="contact-details-list">
                            <li class="contact-item animate-child">
                                <div class="icon"><i class="fas fa-map-marker-alt"></i></div>
                                <div class="contact-item-content">
                                    <h4>Address</h4>
                                    <p>Eheliyagoda Central College, Eheliyagoda, Rathnapura, Sri Lanka.</p>
                                </div>
                            </li>
                            <li class="contact-item animate-child">
                                <div class="icon"><i class="fas fa-envelope"></i></div>
                                <div class="contact-item-content">
                                    <h4>Email</h4>
                                    <p><a href="mailto:emmvprefects@gmail.com">emmvprefects@gmail.com</a></p>
                                </div>
                            </li>
                            <li class="contact-item animate-child">
                                <div class="icon"><i class="fas fa-phone"></i></div>
                                <div class="contact-item-content">
                                    <h4>Phone (Only About PMS)</h4>
                                    <p>077 991 2589 (Hansaka)</p>
                                    <p>072 420 7000 (Adeesha)</p>
                                    <p>071 591 0595 (Thevindu)</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="contact-map animate-child">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3961.3139841487673!2d80.26017487397701!3d6.8529164192497145!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3ae3af908a1d272f%3A0xe33a51c52eca2ec!2sEheliyagoda%20Central%20College!5e0!3m2!1sen!2ssg!4v1759766622909!5m2!1sen!2ssg" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                    </div>
                </div>
            </section>
        </div>

        <footer class="portfolio-footer">
            <div class="social-icons">
                <a href="https://www.facebook.com/profile.php?id=61552015108523" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="tel:0779912589" target="_blank" aria-label="Phone"><i class="fa-solid fa-phone"></i></a>
                <a href="mailto:emmvprefects@gmail.com" target="_blank" aria-label="Email"><i class="fa-solid fa-envelope"></i></a>
            </div>
            <p class="copyright-main">P.M.S © 2025 Hansaka P. Fernando</p>
            <p class="copyright-credits">Adeesha Ravimal Kannangara | Thevindu Thisev Rajapaksha | Hansaka Fernando</p>
        </footer>
    </div>
    
    <div id="creators-modal" class="modal">
        <div class="modal-content-wrapper">
             <div class="auth-card creators-card">
                <div class="swimming-symbols-background"></div> <!-- New element for animation -->
                <span class="close-button">×</span>
                <h3>PMS DEVELOPER TEAM</h3>
                <div class="hero-divider"></div>
                                    <div class="developer-cards-container" id="developer-accordion">
                                        <!-- Adeesha -->
                                        <div class="developer-accordion-item">
                                            <div class="developer-accordion-header">
                                                <img src="Developer Team/no-dp_16.webp" alt="Adeesha Ravimal">
                                                <div class="developer-info">
                                                    <h4>Adeesha Ravimal</h4>
                                                    <p class="role">UI/UX & System Dev</p>
                                                </div>
                                                <i class="fas fa-chevron-down accordion-icon"></i>
                                            </div>
                                            <div class="developer-accordion-content">
                                                <div class="dev-skills"><i class="fas fa-palette" title="UI/UX Design"></i><i class="fas fa-code" title="System Development"></i><i class="fab fa-python" title="Python"></i></div>
                                                <div class="dev-social-icons"><a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a><a href="#" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a><a href="mailto:adeesharavimal@gmail.com" aria-label="Email"><i class="fas fa-envelope"></i></a></div>
                                            </div>
                                        </div>
                                        <!-- Thevindu -->
                                        <div class="developer-accordion-item">
                                            <div class="developer-accordion-header">
                                                <img src="Developer Team/thevindu.JPG" alt="Thevindu Thisev">
                                                <div class="developer-info">
                                                    <h4>Thevindu Thisev</h4>
                                                    <p class="role">Back-End & Database</p>
                                                </div>
                                                <i class="fas fa-chevron-down accordion-icon"></i>
                                            </div>
                                            <div class="developer-accordion-content">
                                                <div class="dev-skills"><i class="fas fa-server" title="Back-End"></i><i class="fas fa-database" title="Database"></i><i class="fab fa-node-js" title="Node.js"></i></div>
                                                <div class="dev-social-icons"><a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a><a href="#" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a><a href="mailto:#" aria-label="Email"><i class="fas fa-envelope"></i></a></div>
                                            </div>
                                        </div>
                                        <!-- Hansaka -->
                                        <div class="developer-accordion-item">
                                            <div class="developer-accordion-header">
                                                <img src="Developer Team/Hansaka.png" alt="Hansaka Fernando">
                                                <div class="developer-info">
                                                    <h4>Hansaka Fernando</h4>
                                                    <p class="role">UI/UX & Front-End</p>
                                                </div>
                                                <i class="fas fa-chevron-down accordion-icon"></i>
                                            </div>
                                            <div class="developer-accordion-content">
                                                <div class="dev-skills"><i class="fab fa-figma" title="Figma"></i><i class="fab fa-html5" title="HTML5"></i><i class="fab fa-css3-alt" title="CSS3"></i><i class="fab fa-js-square" title="JavaScript"></i></div>
                                                <div class="dev-social-icons"><a href="https://www.facebook.com/share/1A2sZTerYJ/" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a><a href="https://chat.whatsapp.com/C4aXtP8cV1QD2VwJ6EgEIK" target="_blank" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a><a href="mailto:emmvprefects@gmail.com" aria-label="Email"><i class="fas fa-envelope"></i></a></div>
                                            </div>
                                        </div>
                                    </div>            </div>
        </div>
    </div>
    
    <div class="creators-fab" id="creators-fab">
        <i class="fas fa-code"></i>
    </div>

    <button class="chat-fab" id="chatFab" aria-label="සහායතාවක් සඳහා සංවාද විවෘත කරන්න">
    <i class="fas fa-comments"></i>
</button>

<div class="chat-container" id="chatContainer">
    <div class="chat-header">
        <h3>PREFECTS GUILD HELP</h3>
        <button class="chat-close" id="chatClose">×</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-area">
        <input 
            type="text" 
            class="chat-input" 
            id="chatInput" 
            placeholder="Type Your Message..."
            autocomplete="off"
        >
        <button class="chat-send" id="chatSend">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<div id="auth-modal" class="modal" style="display: none;">
    <div class="modal-content-wrapper">
        <div class="auth-card" style="text-align: center;">
            <span class="close-button" id="auth-close-btn"><i class="fas fa-times"></i></span>
            <img src="meroon Transparent logo prefect.png" alt="School Logo" style="height: 70px; margin-bottom: 1rem;">
            <h3 id="auth-title">Login</h3>
            <p id="auth-error" style="color: red; display: none; margin-top: 10px;"></p>
            <form id="auth-form" style="display: flex; flex-direction: column; gap: 1rem;">
                <input type="email" id="auth-email" placeholder="Email Address" required style="padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                <input type="password" id="auth-password" placeholder="Password" required style="padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                <button type="submit" id="auth-submit-btn" style="padding: 12px; background-color: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; font-weight: 600;">Login</button>
            </form>
            <p id="auth-toggle-text" style="margin-top: 1rem;">Don't have an account? <a href="#" id="auth-toggle-link" style="color: var(--primary-color); font-weight: 600;">Sign Up</a></p>
        </div>
    </div>
</div>

<div id="gallery-lightbox" class="lightbox">
    <span class="lightbox-close">&times;</span>
    <a class="lightbox-prev">&#10094;</a>
    <a class="lightbox-next">&#10095;</a>
    <img class="lightbox-content" id="lightbox-img">
    <div id="lightbox-caption"></div>
</div>

<script type="module">
    // --- START: FULLY CORRECTED SCRIPT WITH DYNAMIC GALLERY ---

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
    import { 
        getAuth, onAuthStateChanged, createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, signOut 
    } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-auth.js";
    import { 
        getFirestore, collection, getDocs, initializeFirestore, 
        doc, addDoc, setDoc, serverTimestamp, onSnapshot, query, orderBy, limit
    } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "AIzaSyCEvF1sD56pmtYlbno4QAY_Kr5xeFrTAvU",
        authDomain: "prefect-management-syste-e1575.firebaseapp.com",
        projectId: "prefect-management-syste-e1575",
        storageBucket: "prefect-management-syste-e1575.appspot.com",
        messagingSenderId: "973932803095",
        appId: "1:973932803095:web:a7f2db386cafb53330d852",
        measurementId: "G-FLF7R3B8J3"
    };

    const app = initializeApp(firebaseConfig);
    const db = initializeFirestore(app, { experimentalForceLongPolling: true });
    const auth = getAuth(app);

        // ===================================================

        // === 1. AUTHENTICATION LOGIC & UI SETUP ===

        // ===================================================

    

        // === START: MODIFIED JS VARIABLES ===

        // Mobile controls (original)

        const loginNavBtn = document.getElementById('login-nav-btn');

        const logoutNavBtn = document.getElementById('logout-nav-btn');

        const userStatus = document.getElementById('user-status');

        const userEmailSpan = document.getElementById('user-email');

        

        // Desktop controls (new)

        const loginNavBtnDesktop = document.getElementById('login-nav-btn-desktop');

        const logoutNavBtnDesktop = document.getElementById('logout-nav-btn-desktop');

        const userStatusDesktop = document.getElementById('user-status-desktop');

        const userEmailSpanDesktop = document.getElementById('user-email-desktop');

        // === END: MODIFIED JS VARIABLES ===

    

        const authModal = document.getElementById('auth-modal');

        const authCloseBtn = document.getElementById('auth-close-btn');

        const authForm = document.getElementById('auth-form');

        const authTitle = document.getElementById('auth-title');

        const authError = document.getElementById('auth-error');

        const authSubmitBtn = document.getElementById('auth-submit-btn');

        const authToggleText = document.getElementById('auth-toggle-text');

        const authEmailInput = document.getElementById('auth-email');

        const authPasswordInput = document.getElementById('auth-password');

        const chatFab = document.getElementById('chatFab');

        

        let isLoginMode = true;

    

        function showSuccessToast(message) {

            const toast = document.getElementById('success-toast');

            if (!toast) return;

            toast.textContent = message;

            toast.classList.add('show');

            setTimeout(() => { toast.classList.remove('show'); }, 3000);

        }

    

        function openAuthModal() {

            authModal.style.display = 'block';

            // Use a timeout to allow the display property to apply before starting the transition

            setTimeout(() => authModal.classList.add('show'), 10);

        }

        function closeAuthModal() {

            authModal.classList.remove('show');

            // Wait for the transition to finish before hiding the element

            setTimeout(() => {

                authModal.style.display = 'none';

                authForm.reset();

                authError.style.display = 'none';

            }, 300); // Match CSS transition duration

        }

    

        // === START: MODIFIED JS CLICK HANDLERS ===

        loginNavBtn.addEventListener('click', (e) => { e.preventDefault(); openAuthModal(); });

        loginNavBtnDesktop.addEventListener('click', (e) => { e.preventDefault(); openAuthModal(); }); // Add this

        // === END: MODIFIED JS CLICK HANDLERS ===

    

        authCloseBtn.addEventListener('click', closeAuthModal);

        window.addEventListener('click', (event) => { if (event.target == authModal) { closeAuthModal(); } });

    

        authToggleText.addEventListener('click', (e) => {

            if (e.target.id === 'auth-toggle-link') {

                e.preventDefault();

                isLoginMode = !isLoginMode;

                authTitle.textContent = isLoginMode ? 'Login' : 'Sign Up';

                authSubmitBtn.textContent = isLoginMode ? 'Login' : 'Sign Up';

                authToggleText.innerHTML = isLoginMode 

                    ? `Don't have an account? <a href="#" id="auth-toggle-link" style="color: var(--primary-color); font-weight: 600;">Sign Up</a>`

                    : `Already have an account? <a href="#" id="auth-toggle-link" style="color: var(--primary-color); font-weight: 600;">Login</a>`;

                authError.style.display = 'none';

            }

        });

    

        // === START: MODIFIED onAuthStateChanged ===

        onAuthStateChanged(auth, async user => {

            if (user) {

                // Mobile

                loginNavBtn.style.display = 'none';

                logoutNavBtn.style.display = 'block';

                userStatus.style.display = 'none'; 

                userEmailSpan.textContent = user.email;

                

                // Desktop

                loginNavBtnDesktop.style.display = 'none';

                logoutNavBtnDesktop.style.display = 'block';

                userStatusDesktop.style.display = 'none'; 

                userEmailSpanDesktop.textContent = user.email;

                

                chatFab.style.display = 'flex';

                closeAuthModal();

    

                // Update prefects collection with display name and photo URL if not already set

                try {

                    const prefectsRef = collection(db, "prefects");

                    const q = query(prefectsRef, where("uid", "==", user.uid));

                    const querySnapshot = await getDocs(q);

    

                    if (!querySnapshot.empty) {

                        const prefectDocRef = doc(db, "prefects", querySnapshot.docs[0].id);

                        const prefectData = querySnapshot.docs[0].data();

                        

                        const updateData = {};

                        if (!prefectData.name) {

                            updateData.name = user.displayName || user.email.split('@')[0];

                        }

                        if (!prefectData.picture) {

                            updateData.picture = user.photoURL || 'no-dp_16.webp';

                        }

    

                        if (Object.keys(updateData).length > 0) {

                            await setDoc(prefectDocRef, updateData, { merge: true });

                        }

                    }

                } catch (error) {

                    console.error("Error updating prefect profile:", error);

                }

    

            } else {

                // Mobile

                loginNavBtn.style.display = 'block';

                logoutNavBtn.style.display = 'none';

                userStatus.style.display = 'none';

                userEmailSpan.textContent = '';

                

                // Desktop

                loginNavBtnDesktop.style.display = 'block';

                logoutNavBtnDesktop.style.display = 'none';

                userStatusDesktop.style.display = 'none';

                userEmailSpanDesktop.textContent = '';

                

                chatFab.style.display = 'none';

                chatContainer.classList.remove('active');

                isChatOpen = false;

                if (chatUnsubscribe) chatUnsubscribe();

            }

        });

        // === END: MODIFIED onAuthStateChanged ===

    

        authForm.addEventListener('submit', async (e) => {

            e.preventDefault();

            const email = authEmailInput.value;

            const password = authPasswordInput.value;

            authError.style.display = 'none';

            try {

                if (isLoginMode) {

                    await signInWithEmailAndPassword(auth, email, password);

                    showSuccessToast('Login Successful!');

                } else {

                    await createUserWithEmailAndPassword(auth, email, password);

                    showSuccessToast('Sign Up Successful!');

                }

            } catch (error) {

                console.error("Authentication Error:", error.message);

                authError.textContent = error.message;

                authError.style.display = 'block';

            }

        });

    

        // === START: MODIFIED LOGOUT HANDLERS ===

        logoutNavBtn.addEventListener('click', async (e) => {

            e.preventDefault();

            try {

                await signOut(auth);

                showSuccessToast('You have been logged out.');

            } catch (error) { console.error("Logout Error:", error); }

        });

        logoutNavBtnDesktop.addEventListener('click', async (e) => { // Add this

            e.preventDefault();

            try {

                await signOut(auth);

                showSuccessToast('You have been logged out.');

            } catch (error) { console.error("Logout Error:", error); }

        });

        // === END: MODIFIED LOGOUT HANDLERS ===

    // ===================================================
    // === 2. AUTH-INTEGRATED REAL-TIME CHAT BOT LOGIC ===
    // ===================================================
    const chatClose = document.getElementById('chatClose');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const chatSend = document.getElementById('chatSend');

    let isChatOpen = false;
    let chatUnsubscribe = null;

    function listenForMessages(uid) {
        if (chatUnsubscribe) chatUnsubscribe();
        const messagesRef = collection(db, 'chats', uid, 'messages');
        const q = query(messagesRef, orderBy('timestamp'));
        chatUnsubscribe = onSnapshot(q, (snapshot) => {
            chatMessages.innerHTML = '';
            if (snapshot.empty && isChatOpen) { addBotMessage('ආයුබෝවන්! ඔබට සහය විය හැක්කේ කෙසේද?'); }
            snapshot.forEach((doc) => {
                const message = doc.data();
                if (message.senderId === uid) { addUserMessageToScreen(message.text); } 
                else { addBotMessage(message.text); }
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    }

    function addBotMessage(text) {
        const msgDiv = document.createElement('div');
        msgDiv.className = 'message bot-message';
        msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
        chatMessages.appendChild(msgDiv);
    }

    function addUserMessageToScreen(text) {
        const msgDiv = document.createElement('div');
        msgDiv.className = 'message user-message';
        msgDiv.innerHTML = `<div class="message-content">${text}</div>`;
        chatMessages.appendChild(msgDiv);
    }

    async function handleUserInput() {
        const currentUser = auth.currentUser;
        if (!currentUser) { alert("කරුණාකර පණිවිඩයක් යැවීමට ලොග් වන්න."); return; }
        
        const userInput = chatInput.value.trim();
        if (!userInput) return;
        
        const tempUserInput = userInput;
        chatInput.value = '';
        
        try {
            const uid = currentUser.uid;
            const email = currentUser.email;
            
            const sessionDocRef = doc(db, "chats", uid);
            const messagesColRef = collection(sessionDocRef, "messages");
            
            await setDoc(sessionDocRef, {
                lastUpdate: serverTimestamp(),
                lastMessageSnippet: tempUserInput.substring(0, 50),
                userEmail: email
            }, { merge: true });
            
            await addDoc(messagesColRef, {
                text: tempUserInput,
                senderId: uid,
                timestamp: serverTimestamp()
            });
        } catch (error) {
            console.error("Error sending message:", error);
            chatInput.value = tempUserInput;
        }
    }

    chatFab.addEventListener('click', () => {
        const currentUser = auth.currentUser;
        if (!currentUser) { openAuthModal(); return; }
        isChatOpen = !isChatOpen;
        chatContainer.classList.toggle('active');
        if (isChatOpen) {
            listenForMessages(currentUser.uid);
            chatInput.focus();
        } else {
            if (chatUnsubscribe) chatUnsubscribe();
        }
    });

    chatClose.addEventListener('click', () => {
        isChatOpen = false;
        chatContainer.classList.remove('active');
        if (chatUnsubscribe) chatUnsubscribe();
    });

    chatSend.addEventListener('click', handleUserInput);
    chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleUserInput(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && isChatOpen) { chatClose.click(); } });

    // ===================================================
    // === 3. OTHER PAGE LOGIC (Scroll, Modals, etc.) ===
    // ===================================================

    window.onload = () => {
        const loader = document.getElementById('loader');
        if(loader) loader.classList.add('hidden');
    };
    
    const header = document.getElementById('portfolio-header');
    if (header) { window.addEventListener('scroll', () => { header.classList.toggle('header-scrolled', window.scrollY > 50); }); }

    const animatedElements = document.querySelectorAll('.animate-on-scroll');
    if (window.IntersectionObserver) {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    const children = entry.target.querySelectorAll('.animate-child');
                    children.forEach((child, index) => { child.style.transitionDelay = `${index * 100}ms`; });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        animatedElements.forEach(el => observer.observe(el));
    }

    // --- Counter Animation ---
    const statsSection = document.getElementById('stats-counter');

    if (statsSection) {
        const animateCounters = () => {
            const counters = statsSection.querySelectorAll('.counter');
            counters.forEach(counter => {
                if(counter.dataset.animated) return;
                counter.dataset.animated = "true";

                const target = +counter.getAttribute('data-target');
                let count = 0;
                const duration = 2000; // 2 seconds
                
                // This calculates the increment needed for each frame to finish in 'duration'
                // It assumes roughly 60 frames per second (1000ms / 16.6ms)
                const frameDuration = 1000 / 60;
                const totalFrames = Math.round(duration / frameDuration);
                const increment = target / totalFrames;


                const updateCount = () => {
                    count += increment;
                    if (count < target) {
                        counter.innerText = Math.ceil(count);
                        requestAnimationFrame(updateCount);
                    } else {
                        counter.innerText = target; // Ensure it ends on the exact target
                    }
                };
                requestAnimationFrame(updateCount);
            });
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateCounters();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.4 });

        observer.observe(statsSection);
    }

    // === JS for mobile menu (NO CHANGES NEEDED) ===
    // This correctly targets the mobile nav wrapper (#main-nav) and toggle
    const menuToggle = document.getElementById('menu-toggle');
    const mainNav = document.getElementById('main-nav');
    if(menuToggle && mainNav) {
        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            mainNav.classList.toggle('mobile-nav-active');
        });
        mainNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (!link.parentElement.id.includes('nav-btn')) {
                   menuToggle.classList.remove('active');
                   mainNav.classList.remove('mobile-nav-active');
                }
            });
        });
    }
    
    const creatorsFab = document.getElementById('creators-fab');
    const creatorsModal = document.getElementById('creators-modal');
    const closeCreatorsModalBtn = creatorsModal.querySelector('.close-button');

    const openCreatorsModal = () => {
        creatorsModal.style.display = 'block'; // For the overlay
        setTimeout(() => { // Timeout to allow display to apply before transition
            creatorsModal.classList.add('show');
            creatorsModal.classList.add('visible');
        }, 10);
    };

    const closeCreatorsModal = () => {
        creatorsModal.classList.remove('show');
        creatorsModal.classList.remove('visible');
        // Wait for the drawer slide-out animation to finish
        setTimeout(() => {
            creatorsModal.style.display = 'none';
        }, 500); // Must match the CSS transition duration for the drawer
    };

    creatorsFab.addEventListener('click', openCreatorsModal);
    // Add a null check to prevent script crash if button isn't found
    if (closeCreatorsModalBtn) {
        closeCreatorsModalBtn.addEventListener('click', closeCreatorsModal);
    }
    window.addEventListener('click', (event) => { if (event.target == creatorsModal) closeCreatorsModal(); });

    // Accordion logic for Developer List
    const accordion = document.getElementById('developer-accordion');
    if (accordion) {
        accordion.addEventListener('click', (e) => {
            const header = e.target.closest('.developer-accordion-header');
            if (header) {
                const item = header.parentElement;
                // Optional: Close other items when one is opened
                // const allItems = accordion.querySelectorAll('.developer-accordion-item');
                // allItems.forEach(i => { if (i !== item) i.classList.remove('active'); });
                item.classList.toggle('active');
            }
        });
    }

    // --- Manual and Auto scroll for testimonials ---
    const slider = document.querySelector('.testimonials-grid');
    if (slider) {
        let isDown = false;
        let startX;
        let scrollLeft;
        let autoScrollInterval;

        const startAutoScroll = () => {
            // To make it seamless, we need to duplicate the content
            const scroller = slider.querySelector('.testimonials-scroller');
            if (scroller && !scroller.classList.contains('duplicated')) {
                const scrollerContent = Array.from(scroller.children);
                scrollerContent.forEach(item => {
                    const duplicatedItem = item.cloneNode(true);
                    duplicatedItem.setAttribute('aria-hidden', true);
                    scroller.appendChild(duplicatedItem);
                });
                scroller.classList.add('duplicated');
            }

            autoScrollInterval = setInterval(() => {
                slider.scrollLeft += 1;
                if (slider.scrollLeft >= scroller.scrollWidth / 2) {
                    slider.scrollLeft = 0;
                }
            }, 25); // Adjust speed here
        };

        const stopAutoScroll = () => {
            clearInterval(autoScrollInterval);
        };

        slider.addEventListener('mouseenter', stopAutoScroll);
        slider.addEventListener('mouseleave', () => {
            if (!isDown) {
                startAutoScroll();
            }
        });

        slider.addEventListener('mousedown', (e) => {
            isDown = true;
            stopAutoScroll();
            slider.classList.add('active');
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        });

        slider.addEventListener('mouseup', () => {
            isDown = false;
            slider.classList.remove('active');
        });

        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2; //scroll-fast
            slider.scrollLeft = scrollLeft - walk;
        });

        startAutoScroll();
    }

    // --- Show More/Less for Teachers ---
    const teachersGrid = document.getElementById('teachers-grid');
    if (teachersGrid) {
        const showMoreTeachersBtn = document.getElementById('show-more-teachers-btn');
        const showLessTeachersBtn = document.getElementById('show-less-teachers-btn');
        const allTeachers = Array.from(teachersGrid.children);
        const initialTeacherCount = 8; // Number of teachers to show initially

        const updateTeacherVisibility = (showAll) => {
            allTeachers.forEach((teacher, index) => {
                // The principal card is not in this grid, so no need to check for it.
                if (showAll || index < initialTeacherCount) {
                    teacher.classList.remove('element-hidden');
                } else {
                    teacher.classList.add('element-hidden');
                }
            });
            showMoreTeachersBtn.style.display = !showAll && allTeachers.length > initialTeacherCount ? 'inline-block' : 'none';
            showLessTeachersBtn.style.display = showAll && allTeachers.length > initialTeacherCount ? 'inline-block' : 'none';
        };

        if (allTeachers.length > initialTeacherCount) {
            updateTeacherVisibility(false); // Initially show limited teachers

            showMoreTeachersBtn.addEventListener('click', () => {
                updateTeacherVisibility(true);
            });

            showLessTeachersBtn.addEventListener('click', () => {
                updateTeacherVisibility(false);
                document.getElementById('teachers-in-charge').scrollIntoView({ behavior: 'smooth' });
            });
        }
    }

    // ===================================================
    // === 4. DYNAMIC DATA LOADING (Prefects & Gallery) ===
    // ===================================================
    
    // --- Prefects List Logic ---
    const prefectsGrid = document.getElementById('prefects-grid');
    const searchBar = document.getElementById('prefect-search-bar');
    const categoryFilterList = document.getElementById('category-filter-list');
    const showMoreBtn = document.getElementById('show-more-btn');
    const showLessBtn = document.getElementById('show-less-btn');
    let fetchedPrefects = [];
    let currentCategory = 'All';
    const initialVisibleCount = 8;
    let visiblePrefectCount = initialVisibleCount;

    async function loadAndDisplayPrefects() {
        if (!prefectsGrid) return;
        try {
            const querySnapshot = await getDocs(collection(db, "prefects"));
            fetchedPrefects = [];
            querySnapshot.forEach((doc) => fetchedPrefects.push(doc.data()));
            populateCategories();
            initializePrefectCards();
            updatePrefectCardVisibility();
        } catch (error) {
            console.error("Error fetching prefects: ", error);
            prefectsGrid.innerHTML = `<p>Error loading prefects.</p>`;
        }
    }

    function populateCategories() {
        if (!categoryFilterList) return;
        const categories = ['All', ...new Set(fetchedPrefects.map(p => p.section).filter(Boolean))];
        categoryFilterList.innerHTML = '';
        categories.forEach(category => {
            const li = document.createElement('li');
            const button = document.createElement('button');
            button.textContent = category;
            button.dataset.category = category;
            if (category === 'All') {
                button.classList.add('active');
            }
            li.appendChild(button);
            categoryFilterList.appendChild(li);
        });
    }

    function initializePrefectCards() {
        if (!prefectsGrid) return;
        prefectsGrid.innerHTML = ''; // Clear loading message
        fetchedPrefects.forEach((prefect, index) => {
            const card = document.createElement('div');
            card.className = 'prefect-card animate-child element-hidden';
            card.dataset.name = (prefect.name || '').toLowerCase();
            card.dataset.category = prefect.section || '';
            card.innerHTML = `
                <img src="${prefect.picture || '25.jpg'}" alt="${prefect.name || 'Prefect'}">
                <h4>${prefect.name || 'No Name'}</h4>
                <p>${prefect.destiny || 'No Position'}</p>
            `;
            prefectsGrid.appendChild(card);
        });
    }

    function updatePrefectCardVisibility() {
        if (!prefectsGrid) return;
        const searchTerm = searchBar.value.toLowerCase();
        
        const allCards = Array.from(prefectsGrid.children).filter(child => child.classList.contains('prefect-card'));
        let visibleCards = [];

        allCards.forEach(card => {
            const nameMatch = card.dataset.name.includes(searchTerm);
            const categoryMatch = currentCategory === 'All' || card.dataset.category === currentCategory;

            if (nameMatch && categoryMatch) {
                visibleCards.push(card);
            }
        });

        // Hide all cards first
        allCards.forEach(card => card.classList.add('element-hidden'));

        // Show only the ones that should be visible up to the limit
        const cardsToShow = visibleCards.slice(0, visiblePrefectCount);
        cardsToShow.forEach(card => card.classList.remove('element-hidden'));

        // Manage Show More/Less buttons
        showMoreBtn.style.display = visibleCards.length > visiblePrefectCount ? 'inline-block' : 'none';
        showLessBtn.style.display = visiblePrefectCount > initialVisibleCount && visibleCards.length > 0 ? 'inline-block' : 'none';
        
        // Handle no results message
        const noResultsMsg = prefectsGrid.querySelector('.no-results-message');
        if (visibleCards.length === 0) {
            if (!noResultsMsg) {
                const p = document.createElement('p');
                p.textContent = 'No prefects found matching your criteria.';
                p.className = 'no-results-message';
                prefectsGrid.appendChild(p);
            }
        } else {
            if (noResultsMsg) {
                noResultsMsg.remove();
            }
        }
    }
    
    if (prefectsGrid) {
        searchBar.addEventListener('input', () => {
            visiblePrefectCount = initialVisibleCount; // Reset count on new search
            updatePrefectCardVisibility();
        });

        categoryFilterList.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                currentCategory = e.target.dataset.category;
                visiblePrefectCount = initialVisibleCount; // Reset count on category change
                
                categoryFilterList.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                updatePrefectCardVisibility();
            }
        });

        showMoreBtn.addEventListener('click', () => {
            visiblePrefectCount += initialVisibleCount;
            updatePrefectCardVisibility();
        });

        showLessBtn.addEventListener('click', () => {
            visiblePrefectCount = initialVisibleCount;
            updatePrefectCardVisibility();
            document.getElementById('prefects-list').scrollIntoView({ behavior: 'smooth' });
        });
    }

    // --- Dynamic Public Gallery Logic ---
    const publicGalleryGrid = document.getElementById('gallery-grid-public');

    async function loadPublicGallery() {
        if (!publicGalleryGrid) return;
        try {
            const q = query(collection(db, 'gallery'), orderBy('uploadedAt', 'desc'));
            const querySnapshot = await getDocs(q);
            
            publicGalleryGrid.innerHTML = '';
            if (querySnapshot.empty) { publicGalleryGrid.innerHTML = '<p>No images in the gallery yet.</p>'; return; }

            querySnapshot.forEach(docSnap => {
                const imageData = docSnap.data();
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item animate-child';
                galleryItem.innerHTML = `<img src="${imageData.url}" alt="Gallery image">`;
                publicGalleryGrid.appendChild(galleryItem);
            });
        } catch (error) {
            console.error("Error loading public gallery:", error);
            publicGalleryGrid.innerHTML = '<p>Could not load gallery images.</p>';
        }
    }

    // --- INITIALIZE ALL DYNAMIC CONTENT ---
    loadAndDisplayPrefects();
    loadPublicGallery();
    loadAnnouncementsAndEvents();

    // --- Dynamic Announcements & Events Logic ---
    const announcementsContainer = document.querySelector('.announcements-container');

    async function loadAnnouncementsAndEvents() {
        if (!announcementsContainer) return;

        const eventsRef = collection(db, 'events');
        const q = query(eventsRef, orderBy('date', 'desc'), limit(3));

        onSnapshot(q, (snapshot) => {
            if (snapshot.empty) {
                announcementsContainer.innerHTML = '<p>No recent announcements or events.</p>';
                return;
            }

            announcementsContainer.innerHTML = ''; // Clear existing static content
            snapshot.forEach(doc => {
                const event = doc.data();
                const eventCard = document.createElement('div');
                eventCard.className = 'announcement-card animate-child';

                // Date formatting from "YYYY-MM-DD" string
                const [year, monthNum, dayNum] = event.date.split('-');
                const eventDate = new Date(year, monthNum - 1, dayNum);
                const month = eventDate.toLocaleString('default', { month: 'short' }).toUpperCase();

                eventCard.innerHTML = `
                    <div class="announcement-date">
                        <span class="day">${dayNum}</span>
                        <span class="month">${month}</span>
                    </div>
                    <div class="announcement-content">
                        <h4>${event.title}</h4>
                        <p>${event.description}</p>
                    </div>
                `;
                announcementsContainer.appendChild(eventCard);
            });
        });
    }

    // --- Theme Toggle Logic ---
    const themeToggleBtns = document.querySelectorAll('.theme-toggle-btn, .theme-toggle-btn-mobile');
    const currentTheme = localStorage.getItem('theme');

    if (currentTheme === 'dark') {
        document.body.classList.add('dark-mode');
    }

    themeToggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            let theme = 'light';
            if (document.body.classList.contains('dark-mode')) {
                theme = 'dark';
            }
            localStorage.setItem('theme', theme);
        });
    });

    // --- Gallery Lightbox Logic ---
    const lightbox = document.getElementById('gallery-lightbox');
    if (lightbox) {
        const publicGalleryGrid = document.getElementById('gallery-grid-public');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxClose = lightbox.querySelector('.lightbox-close');
        const lightboxPrev = lightbox.querySelector('.lightbox-prev');
        const lightboxNext = lightbox.querySelector('.lightbox-next');

        let currentImageIndex = -1;
        let galleryImages = [];

        const openLightbox = (index) => {
            if (index < 0 || index >= galleryImages.length) return;
            currentImageIndex = index;
            lightbox.style.display = 'block';
            lightboxImg.src = galleryImages[currentImageIndex].src;
        };

        const closeLightbox = () => {
            lightbox.style.display = 'none';
        };

        const showNextImage = () => {
            openLightbox((currentImageIndex + 1) % galleryImages.length);
        };

        const showPrevImage = () => {
            openLightbox((currentImageIndex - 1 + galleryImages.length) % galleryImages.length);
        };

        if (publicGalleryGrid) {
            publicGalleryGrid.addEventListener('click', (e) => {
                if (e.target.tagName === 'IMG') {
                    galleryImages = Array.from(publicGalleryGrid.querySelectorAll('img'));
                    const clickedIndex = galleryImages.findIndex(img => img.src === e.target.src);
                    if (clickedIndex !== -1) {
                        openLightbox(clickedIndex);
                    }
                }
            });
        }

        lightboxClose.addEventListener('click', closeLightbox);
        lightboxNext.addEventListener('click', showNextImage);
        lightboxPrev.addEventListener('click', showPrevImage);

        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                closeLightbox();
            }
        });
        
        document.addEventListener('keydown', (e) => {
            if (lightbox.style.display === 'block') {
                if (e.key === 'ArrowRight') showNextImage();
                else if (e.key === 'ArrowLeft') showPrevImage();
                else if (e.key === 'Escape') closeLightbox();
            }
        });
    }

</script>

</body>
</html>
